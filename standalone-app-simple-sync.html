<!DOCTYPE html>
<html lang="en-IN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker - Naga & Sandeep</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-yellow': { DEFAULT: '#FBBF24' }
                    }
                }
            }
        }
    </script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        .hidden { display: none !important; }
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 0.375rem; cursor: pointer; transition: all 0.2s; color: white; font-size: 0.875rem; }
        .calendar-day:hover:not(.disabled) { background-color: #374151; }
        .calendar-day.selected { background-color: #FBBF24; color: #111827; font-weight: bold; }
        .calendar-day.today { border: 2px solid #FBBF24; }
        .calendar-day.disabled { opacity: 0.3; cursor: not-allowed; }
        .calendar-header { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem; margin-bottom: 0.5rem; }
        .calendar-header-day { text-align: center; font-size: 0.875rem; font-weight: 600; color: #FBBF24; padding: 0.5rem 0; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 50; padding: 1rem; }
        #qrcode { display: flex; justify-content: center; align-items: center; }
        #qrcode canvas { display: block; margin: 0 auto; }
        #qrcode img { display: block; margin: 0 auto; }
        .sync-indicator { position: fixed; top: 10px; right: 10px; padding: 8px 12px; border-radius: 20px; font-size: 12px; z-index: 100; }
        .sync-indicator.synced { background: #10b981; color: white; }
        .sync-indicator.syncing { background: #f59e0b; color: white; }
        .sync-indicator.offline { background: #ef4444; color: white; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="syncIndicator" class="sync-indicator synced">● Synced</div>
    <div id="app"></div>

    <script>
        // ===== SIMPLE CLOUD SYNC USING JSONBIN.IO =====
        // Get your free API key from: https://jsonbin.io/
        // Or use the demo key (limited to 100 requests/month)
        const JSONBIN_API_KEY = '$2a$10$demo_key_get_yours_from_jsonbin_io';
        const JSONBIN_BIN_ID = 'YOUR_BIN_ID_HERE'; // Create a bin at jsonbin.io and paste ID here
        
        let syncEnabled = false;
        let lastSyncTime = 0;
        const SYNC_INTERVAL = 3000; // Sync every 3 seconds

        function updateSyncIndicator(status) {
            const indicator = document.getElementById('syncIndicator');
            indicator.className = 'sync-indicator ' + status;
            indicator.textContent = status === 'synced' ? '● Synced' : 
                                   status === 'syncing' ? '● Syncing...' : 
                                   '● Offline';
        }

        async function syncToCloud(data) {
            if (!syncEnabled || !JSONBIN_BIN_ID || JSONBIN_BIN_ID === 'YOUR_BIN_ID_HERE') {
                updateSyncIndicator('offline');
                return;
            }

            try {
                updateSyncIndicator('syncing');
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    updateSyncIndicator('synced');
                    lastSyncTime = Date.now();
                }
            } catch (error) {
                console.warn('Sync failed:', error);
                updateSyncIndicator('offline');
            }
        }

        async function syncFromCloud() {
            if (!syncEnabled || !JSONBIN_BIN_ID || JSONBIN_BIN_ID === 'YOUR_BIN_ID_HERE') {
                return null;
            }

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result.record;
                }
            } catch (error) {
                console.warn('Sync from cloud failed:', error);
            }
            return null;
        }

        // Auto-sync every few seconds
        setInterval(async () => {
            if (Date.now() - lastSyncTime > SYNC_INTERVAL) {
                const cloudData = await syncFromCloud();
                if (cloudData && JSON.stringify(cloudData) !== JSON.stringify({
                    walletBalance: AppState.walletBalance,
                    expenses: AppState.expenses
                })) {
                    AppState.walletBalance = cloudData.walletBalance || AppState.walletBalance;
                    AppState.expenses = (cloudData.expenses || []).map(exp => ({
                        ...exp,
                        createdAt: new Date(exp.createdAt)
                    }));
                    localStorage.setItem('walletBalance', AppState.walletBalance);
                    localStorage.setItem('expenses', JSON.stringify(AppState.expenses));
                    render();
                }
            }
        }, SYNC_INTERVAL);
